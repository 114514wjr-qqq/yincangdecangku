<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>XX电商·运营后台·订单录入与销售看板</title>
    <style>
        body { font-family: Arial, sans-serif; }
        .box { border: 1px solid #ddd; padding: 10px; margin: 10px 0; }
        .clock { font-size: 20px; font-weight: bold; color: #336699; margin: 10px 0; }
        label { display: inline-block; width: 120px; margin: 5px 0; }
        input, select { padding: 4px; width: 200px; }
        button { padding: 6px 20px; margin: 10px 0; cursor: pointer; }
        table { border-collapse: collapse; width: 100%; margin-top: 10px; }
        th, td { border: 1px solid #ccc; padding: 4px 8px; text-align: center; }
        th { background-color: #f5f5f5; }
        .tips { margin: 10px 0; padding: 12px; border-left: 5px solid; }
        .success { color: #3c763d; background-color: #dff0d8; border-color: #3c763d; }
        .warning { color: #8a6d3b; background-color: #fcf8e3; border-color: #8a6d3b; }
        .info { color: #31708f; background-color: #d9edf7; border-color: #31708f; }
        .normal { color: #737373; background-color: #f5f5f5; border-color: #ccc; }
    </style>
</head>
<body>
    <!-- 页面标题与欢迎语 -->
    <script>
        document.write("<h1>XX电商·运营后台·订单录入与销售看板</h1>");
        document.write("<p>欢迎使用内部工具，实时查看订单与销售情况。</p>");
        
        // 优惠与加价政策提示
        document.write(`
            <div class="tips info">
                <strong>温馨提示：本店当前可享受的优惠与加价政策如下：</strong>
                <ul style="margin: 8px 0 0 20px; line-height: 1.6;">
                    <li>VIP 客户享受<strong>9 折优惠</strong></li>
                    <li>加急发货价格会<strong>×1.1</strong></li>
                    <li>每小时前10分钟再享 <strong>8.5 折</strong></li>
                </ul>
            </div>
        `);
        
        // 时段折扣提示（每小时前10分钟判断）
        var nowForBanner = new Date();
        var minuteForBanner = nowForBanner.getMinutes();
        if (minuteForBanner >= 0 && minuteForBanner <= 9) {
            document.write(`
                <div class="tips warning">
                    当前为前 10 分钟！本单可额外享受<strong>8.5 折</strong>时段优惠！
                </div>
            `);
        } else {
            document.write(`
                <div class="tips normal">
                    小贴士：每个整点前10分钟享受 8.5 折优惠，请留意下单时间~
                </div>
            `);
        }
    </script>

    <!-- 实时时钟 -->
    <div class="clock" id="clock"></div>

    <!-- 订单录入表单 -->
    <div class="box">
        <h3>新建订单</h3>
        <form onsubmit="return validateForm()">
            <label>客户名称：</label>
            <input type="text" id="customerName" placeholder="请输入客户姓名"><br>

            <label>商品单价（¥）：</label>
            <input type="number" id="priceInput" placeholder="请输入大于0的数字"><br>

            <label>数量（件）：</label>
            <input type="number" id="qtyInput" placeholder="请输入大于0的整数"><br>

            <label>客户类型：</label>
            <select id="customerType">
                <option value="normal">普通客户</option>
                <option value="vip">VIP客户</option>
            </select><br>

            <label>加急发货：</label>
            <input type="checkbox" id="urgentFlag"><br>

            <button type="submit">添加订单</button>
        </form>
    </div>

    <!-- 订单结果显示区 -->
    <div id="orderResult" class="box"></div>

    <!-- 销售看板与订单历史 -->
    <div class="box">
        <h3>销售看板</h3>
        <div id="dashboard"></div>
        
        <h3>订单历史</h3>
        <div id="orderTable"></div>
    </div>

    <script>
        // 全局订单数组，存储所有订单记录
        var orders = [];

        // 1. 时钟功能实现
        function padZero(n) {
            return n < 10 ? "0" + n : n;
        }

        function updateClock() {
            var now = new Date();
            var y = now.getFullYear();
            var m = now.getMonth() + 1;
            var d = now.getDate();
            var hh = now.getHours();
            var mm = now.getMinutes();
            var ss = now.getSeconds();
            var weekNames = ["日", "一", "二", "三", "四", "五", "六"];
            var w = weekNames[now.getDay()];
            var timeStr = `${y}年${padZero(m)}月${padZero(d)}日 星期${w} ${padZero(hh)}:${padZero(mm)}:${padZero(ss)}`;
            document.getElementById("clock").innerHTML = timeStr;
        }

        // 页面加载时初始化时钟并每秒更新
        updateClock();
        setInterval(updateClock, 1000);

        // 2. 表单验证功能
        function validateForm() {
            var nameStr = document.getElementById("customerName").value;
            var priceStr = document.getElementById("priceInput").value;
            var qtyStr = document.getElementById("qtyInput").value;
            var typeStr = document.getElementById("customerType").value;
            var urgentChecked = document.getElementById("urgentFlag").checked;
            var valid = true;

            // 客户名称校验
            if (nameStr == null || nameStr.trim() === "") {
                alert("客户名称不能为空！");
                valid = false;
            }

            // 商品单价校验（大于0的数字）
            var price = parseFloat(priceStr);
            if (isNaN(price) || price <= 0) {
                alert("商品单价必须是大于0的数字！");
                valid = false;
            }

            // 数量校验（大于0的整数）
            var qty = parseInt(qtyStr, 10);
            if (isNaN(qty) || qty <= 0) {
                alert("数量必须是大于0的整数！");
                valid = false;
            }

            // 验证失败提示
            if (!valid) {
                document.getElementById("orderResult").innerHTML = "<p class='warning'>订单录入失败，请检查输入。</p>";
                return false;
            }

            // 验证通过，处理订单
            processOrder(nameStr.trim(), price, qty, typeStr === "vip", urgentChecked);
            return false; // 阻止表单默认提交行为
        }

        // 3. 订单处理与折扣计算（核心功能）
        function processOrder(customerName, price, quantity, isVip, isUrgent) {
            // 基础计算：单价 × 数量
            var baseTotal = price * quantity;
            // VIP折扣：9折
            var afterVip = isVip ? baseTotal * 0.9 : baseTotal;
            // 加急加价：1.1倍（学号末位0的同学需修改此处，见下方注释）
            var afterUrgent = isUrgent ? afterVip * 1.1 : afterVip;
            // 时段折扣判断（前10分钟8.5折）
            var now = new Date();
            var minute = now.getMinutes();
            var hitTimeDiscount = minute >= 0 && minute <= 9;
            var finalTotal = afterUrgent;

            // 时段折扣应用
            if (hitTimeDiscount) {
                finalTotal *= 0.85;
            }

            // ================= 学号末位特殊规则（根据自己学号修改）=================
            // 请将下方对应学号的代码取消注释，其余保持注释状态！
            // 示例：学号末位是3，就只取消第3条的注释

            // 0号规则：前20分钟时段折扣 + 加急免加价
            // if (minute < 20 && orders.length > 0) {
            //     hitTimeDiscount = true;
            //     finalTotal = afterVip * 0.85; // 加急不加价
            // }

            // 1号规则：VIP+加急 → 免除加急加价
            // if (isVip && isUrgent) {
            //     finalTotal = afterVip * (hitTimeDiscount ? 0.85 : 1); // 加急免费
            // }

            // 2号规则：普通客户+数量>3 → 额外9折
            // if (!isVip && quantity > 3) {
            //     finalTotal *= 0.9;
            // }

            // 3号规则：VIP+折扣后金额>1000 → 直减50元（最低0）
            // if (isVip && finalTotal > 1000) {
            //     finalTotal = Math.max(finalTotal - 50, 0);
            // }

            // 4号规则：普通客户+折扣后金额>500 → 额外9.5折
            // if (!isVip && finalTotal > 500) {
            //     finalTotal *= 0.95;
            // }

            // 5号规则：前10分钟+数量≥5 → 额外8折（叠加）
            // if (hitTimeDiscount && quantity >= 5) {
            //     finalTotal *= 0.8;
            // }

            // 6号规则：未加急+数量≥2 → 额外98折
            // if (!isUrgent && quantity >= 2) {
            //     finalTotal *= 0.98;
            // }

            // 7号规则：VIP+未享时段折扣 → 额外9.5折
            // if (isVip && !hitTimeDiscount) {
            //     finalTotal *= 0.95;
            // }

            // 8号规则：普通客户+折扣后金额>200 → 减10元（最低0）
            // if (!isVip && finalTotal > 200) {
            //     finalTotal = Math.max(finalTotal - 10, 0);
            // }

            // 9号规则：VIP+最终金额<基础金额7折 → 最低7折封顶
            // if (isVip && finalTotal < baseTotal * 0.7) {
            //     finalTotal = baseTotal * 0.7;
            // }
            // =====================================================================

            // 订单重要性判断
            var isImportant = isVip && finalTotal > 1000;

            // 构建优惠详情HTML
            var tipsHtml = "<ul>";
            tipsHtml += isVip ? "<li>VIP 9折已应用</li>" : "<li>普通客户无VIP优惠</li>";
            tipsHtml += isUrgent ? "<li>加急 ×1.1 已应用</li>" : "<li>未加急</li>";
            tipsHtml += hitTimeDiscount ? "<li>命中前10分钟 ×0.85</li>" : "<li>无时段折扣</li>";
            
            // 补充学号特殊规则的优惠说明（根据自己的规则修改）
            // 示例：3号规则补充说明
            // if (isVip && finalTotal > 1000) {
            //     tipsHtml += "<li>VIP大额订单直减50元</li>";
            // }

            tipsHtml += "</ul>";

            // 显示订单结果
            document.getElementById("orderResult").innerHTML = `
                <h3 class="success">订单录入成功！</h3>
                <p>客户名称：${customerName}</p>
                <p>基础金额：¥${baseTotal.toFixed(2)}</p>
                <p>VIP后金额：¥${afterVip.toFixed(2)}</p>
                <p>加急后金额：¥${afterUrgent.toFixed(2)}</p>
                <p>最终金额：¥${finalTotal.toFixed(2)}</p>
                <p>订单类型：${isImportant ? "大额VIP订单" : "普通订单"}</p>
                <div style="background:#eef; padding:8px; margin-top:10px;">优惠详情：${tipsHtml}</div>
            `;

            // 保存订单到全局数组
            orders.push({
                name: customerName,
                price: price,
                qty: quantity,
                baseTotal: baseTotal,
                finalTotal: finalTotal,
                isVip: isVip,
                isUrgent: isUrgent,
                hitTimeDiscount: hitTimeDiscount
            });

            // 更新销售看板和订单历史
            renderDashboard();
        }

        // 4. 销售看板与订单历史渲染
        function renderDashboard() {
            var count = orders.length;
            var totalSales = 0;

            // 计算销售总额
            for (var i = 0; i < orders.length; i++) {
                totalSales += orders[i].finalTotal;
            }

            // 计算平均客单价
            var avg = count > 0 ? totalSales / count : 0;

            // 渲染销售看板
            document.getElementById("dashboard").innerHTML = `
                <p>订单数：${count} 单</p>
                <p>销售总额：¥${totalSales.toFixed(2)}</p>
                <p>平均客单价：¥${avg.toFixed(2)}</p>
            `;

            // 渲染订单历史表格
            if (count === 0) {
                document.getElementById("orderTable").innerHTML = "<p>暂无订单记录</p>";
                return;
            }

            var tableHtml = `
                <table>
                    <tr>
                        <<th>客户名称</</th>
                        <<th>单价（¥）</</th>
                        <<th>数量（件）</</th>
                        <<th>基础金额（¥）</</th>
                        <<th>最终金额（¥）</</th>
                        <<th>VIP客户</</th>
                        <<th>加急发货</</th>
                        <<th>时段折扣</</th>
                    </tr>
            `;

            // 遍历订单数组，生成表格行
            for (var j = 0; j < orders.length; j++) {
                var o = orders[j];
                tableHtml += `
                    <tr>
                        <td>${o.name}</td>
                        <td>${o.price.toFixed(2)}</td>
                        <td>${o.qty}</td>
                        <td>${o.baseTotal.toFixed(2)}</td>
                        <td>${o.finalTotal.toFixed(2)}</td>
                        <td>${o.isVip ? "是" : "否"}</td>
                        <td>${o.isUrgent ? "是" : "否"}</td>
                        <td>${o.hitTimeDiscount ? "是" : "否"}</td>
                    </tr>
                `;
            }

            tableHtml += "</table>";
            document.getElementById("orderTable").innerHTML = tableHtml;
        }

        // 初始化销售看板（页面加载时显示暂无数据）
        renderDashboard();
    </script>
</body>
</html>
